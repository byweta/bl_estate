<!DOCTYPE html>
<html>
	<head>
		<!-- author：王朝贤 / createTime：2020年3月9日 -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=yes,email=no,date=no,address=no">
		<title>疫情防控人员值班表</title>
		<!-- 引入 jquery-weui -->
		<link rel="stylesheet" type="text/css" href="../css/weui/weui.css" />
		<link rel="stylesheet" type="text/css" href="../css/jqweui/jquery-weui.css">
		<link rel="stylesheet" type="text/css" href="../css/on_duty_info.css?v=1" />
		<style type="text/css">
			body,
			html {
				height: 100%;
				margin: 0;
				padding: 0;
				-webkit-tap-highlight-color: transparent;
				background-color: #F7F7F7;
				position: relative;
			}

			/* 超出单行显示省略号 */
			.line_ellipsis {
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			.hidden_box {
				display: none;
			}
		</style>
	</head>
	<body ontouchstart>
		<div class="nav_header">
			<div class="icon_nav_left" onclick="fnGoBack()"></div>
			<div class="nav_title">疫情防控人员值班表</div>
			<div class="icon_nav_right"></div>
		</div>
		<div class="nav_header_hidden">
		</div>
		<div class="container" id="container">
			<div class="main_box">
				<div class="estate_title">
					{{estateName}}
				</div>
				<div class="dept_bar">
					<div class="dept_box">
						<div class="dept_item">
							<span class="dept_name">区生态环境分局</span>
							<span class="dept_user_name">郝云辉<font class="phone_num" onclick="fnCallTel('15623020329')">15623020329</font></span>
						</div>
						<div class="dept_item">
							<span class="dept_name">安保部门</span>
							<span class="dept_user_name">赵显华</span>
						</div>
						<div class="dept_item">
							<span class="dept_name">卫生防疫部门</span>
							<span class="dept_user_name">王永平<font class="phone_num" onclick="fnCallTel('13636183008')">13636183008</font></span>
						</div>
						<div class="dept_item">
							<span class="dept_name">社区</span>
							<span class="dept_user_name">刘秀华<font class="phone_num" onclick="fnCallTel('13986886805')">13986886805</font></span>
						</div>
					</div>
				</div>
				<div class="estate_title estate_title_1">
					{{estateName1}}
				</div>
				<div class="user_bar">
					<div class="user_box">
						<div class="on_duty_time">
							<div class="time_title">值班时间</div>
							<div class="time_text">
								<div class="day_type">白天</div>
								<div class="day_time">8:00-20:00</div>
							</div>
						</div>
						<div class="on_duty_user">
							<div class="on_duty_item">
								<div class="duty_dept">
									区生态环境分局
								</div>
								<div class="dept_duty_user">
									<div class="line_name">高璟、钱良忠</div>
									<div class="line_num">--、--</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									社区
								</div>
								<div class="dept_duty_user">
									<div class="line_name">刘秀华、戚静</div>
									<div class="line_num"><span onclick="fnCallTel('13986886805')">13986886805</span>、--</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									卫生防疫人员
								</div>
								<div class="dept_duty_user">
									<div class="line_name">王永平</div>
									<div class="line_num" onclick="fnCallTel('13636183008')">13636183008</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									公安民警
								</div>
								<div class="dept_duty_user">
									<div class="line_name">韩小龙</div>
									<div class="line_num" onclick="fnCallTel('18986909517')">18986909517</div>
								</div>
							</div>
						</div>
					</div>
					<div class="user_box user_box_n">
						<div class="on_duty_time">
							<div class="time_title">值班时间</div>
							<div class="time_text">
								<div class="day_type">夜晚</div>
								<div class="day_time">20:00-8:00</div>
							</div>
						</div>
						<div class="on_duty_user">
							<div class="on_duty_item">
								<div class="duty_dept">
									区生态环境分局
								</div>
								<div class="dept_duty_user">
									<div class="line_name">郝云辉</div>
									<div class="line_num" onclick="fnCallTel('15623020329')">15623020329</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									社区
								</div>
								<div class="dept_duty_user">
									<div class="line_name">刘洋</div>
									<div class="line_num" onclick="fnCallTel('13593761951')">13593761951</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									卫生防疫人员
								</div>
								<div class="dept_duty_user">
									<div class="line_name">王永平</div>
									<div class="line_num" onclick="fnCallTel('13636183008')">13636183008</div>
								</div>
							</div>
							<div class="on_duty_item">
								<div class="duty_dept">
									公安民警
								</div>
								<div class="dept_duty_user">
									<div class="line_name">韩小龙</div>
									<div class="line_num" onclick="fnCallTel('18986909517')">18986909517</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="hidden_box">
			<a href="" id="callId">1</a>
		</div>
		<script type="text/javascript" src="../js/url.js" charset="utf-8"></script>
		<script type="text/javascript" src="../js/vue.js" charset="utf-8"></script>
		<script type="text/javascript" src="../js/jquery-1.12.4-min.js" charset="utf-8"></script>
		<script type="text/javascript" src="../js/fastclick.js" charset="utf-8"></script>
		<script type="text/javascript">
			$(function() {
				FastClick.attach(document.body);
			})
		</script>
		<script type="text/javascript" src="../js/jqweui/jquery-weui.min.js" charset="utf-8"></script>
		<script type="text/javascript">
			// 初始化双向绑定模型
			var vue = new Vue({
				el: '#container',
				data: {
					estateName: '值班部门',
					estateName1: '值班人员'
				},
				methods: {
				}
			});
			
			$(function() {
				// 获取楼栋信息
				// fnGetLdInfo();
			});
			
			// 拨打电话
			function fnCallTel(callNo){
				if(callNo == '--'){
					return;
				}
				$("#callId").attr("href", "tel:"+callNo);
				$("#callId")[0].click();
			}
			
			// 选择楼栋
			function fnChangeLd(){
				setTimeout(function(){
					oneOptionId = vue.$data.ld;
					getOptionId(oneOptionId, function(checkOption) {
						vue.$data.ld = checkOption.firstOptionId;
						fnGetPeoplesInfo();
					});
				}, 500);
			}
			
			// 返回
			function fnGoBack(){
				window.top.history.back();
			}
			
			// 获取楼栋信息
			function fnGetLdInfo() {
				$.showLoading();
				var url = mHost + mServerName + "/SQGL/getLouDongList";
				var params = {
				}
				console.log("=== === >> 参数：" + JSON.stringify(params));
				$.ajax({
					type: "get",
					url: url,
					contentType: 'application/x-www-form-urlencoded',
					data: params,
					dataType: "jsonp",
					success: function(result) {
						$.hideLoading();
						if (result.state != undefined && result.state == true) {
							ldList = result.ldList;
							vue.$data.ldList = ldList;
							firstOptions = [];
							for(var i=0; i<ldList.length; i++){
								var item = ldList[i];
								var c = {'id': item, 'value': item+'号楼', 'parentId': '0'}
								firstOptions.push(c);
							}
							vue.$data.ld = ldList[0];
							fnGetPeoplesInfo()
						} else {
							// 失败
							$.toast("失败！", 'cancel');
						}
					},
					error: function(jqXHR, textStatus) {
						$.hideLoading();
						$.toast("服务异常！", 'cancel')
					}
				});
			}
			
			// 获取楼栋人员信息
			function fnGetPeoplesInfo() {
				$.showLoading();
				var url = mHost + mServerName + "/SQGL/getSingelLDRYXXList";
				var params = {
					ld: vue.$data.ld
				}
				console.log("=== === >> 参数：" + JSON.stringify(params));
				$.ajax({
					type: "get",
					url: url,
					contentType: 'application/x-www-form-urlencoded',
					data: params,
					dataType: "jsonp",
					success: function(result) {
						$.hideLoading();
						if (result.state != undefined && result.state == true) {
							var data = result.ldzhList;
							vue.dataList = [];
							vue.dataList = data;
						} else {
							// 失败
							$.toast("失败！", 'cancel');
						}
					},
					error: function(jqXHR, textStatus) {
						$.hideLoading();
						$.toast("服务异常！", 'cancel')
					}
				});
			}
		</script>
	</body>
</html>
